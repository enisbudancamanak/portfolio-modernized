import{o as D,a as b}from"./navigation.yV9gYDoY.js";import{v as E}from"./scheduler.J9bTUkkY.js";const A=!0,I=A;class T extends Set{}const u={};let _=0,p=!1;const v=new Set;function c(e,a){const n=u[e];n&&n.forEach(i=>{try{i.listener(a)}catch(t){console.error(`Error in callback for event "${e}": ${t}`)}i.auto_clean&&n.delete(i)})}function C(e,a,n=!0){function i(){let t=u[e];t||(u[e]=new T,t=u[e]);for(const s of t?.values()??[])if(s.listener===a){t?.delete(s);break}}if(!n)i();else try{b(()=>{i()})}catch{console.warn("I tried to wrap the function within afterNavigate and failed...are you calling this inside afterNavigate?"),i()}}function o(e,a,{registerDuringTransition:n=!1,autoWrap:i=!0,autoClean:t=!0}={}){const s=(l=i)=>C(e,a,l);function r(){function l(){let f=u[e];f||(u[e]=new T,f=u[e]),f?.add({listener:a,auto_clean:t})}if(p&&!n)return v.add(()=>{l()}),s;l()}if(!i)return r(),s;try{b(()=>{r()})}catch{console.warn("I tried to wrap the function within afterNavigate and failed...are you calling this inside afterNavigate?"),r()}return s}function P(e,a=!0){let n;const i=o("transition-finished",()=>{n&&n.length>0&&document.documentElement.classList.remove(...n)},{registerDuringTransition:!1,autoWrap:a});o("before-start-view-transition",t=>{n=Array.isArray(e)?e:e(t),n?document.documentElement.classList.add(...n):i(!0)},{registerDuringTransition:!1,autoWrap:a})}function N(e,a){if(typeof a=="string"){e.style.setProperty("view-transition-name",a);return}function n(t){let s;const r=[];r.push(o("after-navigation-complete",m=>{const{top:y}=e.getBoundingClientRect(),w=y<window.innerHeight+window.scrollY,h={...m,node:e,isInViewport:w};let d=!1;if(t.applyImmediately!=null&&(d=typeof t.applyImmediately=="boolean"?t.applyImmediately:t.applyImmediately(h)),d){const g=typeof t.name=="function"?t.name(h):t.name;e.style.setProperty("view-transition-name",g),r.push(o("transition-finished",()=>{e.style.setProperty("view-transition-name",null)},{registerDuringTransition:!0,autoWrap:!1,autoClean:!1}))}},{registerDuringTransition:!0,autoWrap:!1,autoClean:!1}));const l=o("before-start-view-transition",m=>{let y=!0;const{top:w}=e.getBoundingClientRect(),h=w<window.innerHeight+window.scrollY,d={...m,node:e,isInViewport:h};if(t.shouldApply!=null&&(y=typeof t.shouldApply=="boolean"?t.shouldApply:t.shouldApply(d)),y){const g=typeof t.name=="function"?t.name(d):t.name;e.style.setProperty("view-transition-name",g),r.push(o("transition-finished",()=>{e.style.setProperty("view-transition-name",null)},{autoWrap:!1,registerDuringTransition:!0,autoClean:!1})),t.classes&&(s=Array.isArray(t.classes)?t.classes:t.classes(d)),s?document.documentElement.classList.add(...s):f?.()}},{registerDuringTransition:!1,autoWrap:!1,autoClean:!1});r.push(l);let f;return f=o("transition-finished",()=>{s&&s.length>0&&document.documentElement.classList.remove(...s)},{registerDuringTransition:!1,autoWrap:!1,autoClean:!1}),r.push(f),()=>{r.forEach(m=>{m(!1)})}}let i=n(a);return{update(t){if(i?.(),i=void 0,typeof t=="string"){e.style.setProperty("view-transition-name",t);return}i=n(t)},destroy(){i?.()}}}function L(){return _===0&&I&&document.startViewTransition&&(_++,D(e=>{if(document.startViewTransition)return new Promise(a=>{c("before-start-view-transition",{navigation:e});const n=document.startViewTransition(async()=>{p=!0,c("before-navigation",{navigation:e}),a(),c("before-navigation-complete",{navigation:e}),await e.complete,c("after-navigation-complete",{navigation:e})});n.ready.then(()=>{c("transition-ready",{navigation:e,transition:n})}).catch(console.error),n.updateCallbackDone.then(()=>{c("update-callback-done",{navigation:e,transition:n})}).catch(console.error),n.finished.then(()=>{c("transition-finished",{navigation:e,transition:n}),p=!1,v.forEach(i=>{i()}),v.clear()}).catch(console.error)})}),E(()=>{_--})),{on:o,off:C,transition:N,classes:P}}export{L as s};
